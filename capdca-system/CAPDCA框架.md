# CAPDCA自主循环系统框架

> 版本: v1.0 | 创建日期: 2026-02-04 | 状态: 活跃

## 1. CAPDCA循环概述

### 1.1 什么是CAPDCA？

CAPDCA是一个自主循环优化系统，用于实现持续改进：

```
        ┌─────────────────────────────────────┐
        │                                     │
        ▼                                     │
    ┌───────┐                                 │
    │  C   │ ←──── Check (监控/检查)          │
    │ Check│                                 │
    └───────┘                                 │
         │                                    │
         ▼                                    │
    ┌───────┐                                 │
    │  A   │ ←──── Analyze (分析)             │
    │  Analyze│                               │
    └───────┘                                 │
         │                                    │
         ▼                                    │
    ┌───────┐                                 │
    │  P   │ ←──── Plan (计划)                │
    │  Plan │                                 │
    └───────┘                                 │
         │                                    │
         ▼                                    │
    ┌───────┐                                 │
    │  D   │ ←──── Do (执行)                  │
    │  Do   │                                 │
    └───────┘                                 │
         │                                    │
         ▼                                    │
    ┌───────┐                                 │
    │  C   │ ←──── Check (验证)               │
    │ Check2│                                 │
    └───────┘                                 │
         │                                    │
         ▼                                    │
    ┌───────┐                                 │
    │  A   │ ←──── Adjust (调整)              │
    │Adjust│                                 │
    └───────┘                                 │
         │                                    │
         └────────────────────────────────────┘
              (持续迭代优化)
```

### 1.2 循环核心原则

1. **持续性**：循环永不停止，每次任务都是优化的机会
2. **系统性**：每一步都有明确的输入、输出和检查点
3. **自动化**：触发条件满足时自动进入下一阶段
4. **可追溯**：所有决策和行动都有记录

---

## 2. 各阶段详细定义

### 2.1 C - Check（监控/检查）

**目的**：识别任务需求、异常模式、改进机会

**检查内容**：
- 任务类型识别（深度分析/代码修复/简单任务）
- 复杂度评估（简单/中等/复杂）
- 风险等级判断（低/中/高）
- 资源需求评估
- 时间窗口确认

**触发条件**：
- 新任务到达
- 定时检查（每小时/每天）
- 异常事件触发
- 周期性回顾

**输出**：
- 任务分类结果
- 优先级排序
- 复杂度评分（1-10）

### 2.2 A - Analyze（分析）

**目的**：深入理解任务、识别模式、确定最佳方法

**分析内容**：
- 任务目标拆解
- 依赖关系识别
- 历史经验检索（memory/）
- 类似任务参考
- 风险识别
- 方法论选择（调用对应Skill）

**触发条件**：
- Check阶段完成
- 需要方法论选择

**输出**：
- 任务分解结构
- 推荐的Skill/工具
- 资源分配计划
- 风险缓解策略

### 2.3 P - Plan（计划）

**目的**：制定执行方案、设定里程碑、确定检查点

**计划内容**：
- 执行步骤排序
- 时间估算
- 里程碑定义
- 质量标准设定
- 回滚策略准备

**触发条件**：
- Analyze阶段完成
- 任务方案确定

**输出**：
- 详细执行计划
- 甘特图/时间线
- 检查点清单
- 质量标准

### 2.4 D - Do（执行）

**目的**：按照计划执行任务、记录过程、实时反馈

**执行内容**：
- 按计划步骤执行
- 进度实时记录
- 异常即时报告
- 中间结果保存
- 资源使用监控

**触发条件**：
- Plan阶段完成
- 资源就绪

**输出**：
- 执行日志
- 中间产物
- 进度报告
- 异常记录

### 2.5 C - Check（验证）

**目的**：验证执行结果、对比预期目标、识别偏差

**验证内容**：
- 目标达成率
- 质量标准符合度
- 时间效率评估
- 资源使用效率
- 偏差分析

**触发条件**：
- 执行阶段完成
- 需要结果确认

**输出**：
- 验证报告
- 偏差清单
- 改进建议
- 成功/失败判定

### 2.6 A - Adjust（调整）

**目的**：根据验证结果调整策略、优化流程、更新知识库

**调整内容**：
- 流程优化
- 规则更新
- 知识库补充
- Skill优化
- 预防措施

**触发条件**：
- 验证阶段完成
- 存在改进空间

**输出**：
- 更新后的流程
- 新增规则
- 知识库条目
- 预防措施清单

---

## 3. 触发条件和阈值

### 3.1 任务触发条件

| 任务类型 | 触发条件 | 优先级 |
|---------|---------|--------|
| 简单任务 | <5分钟，单文件，低风险 | P3 |
| 中等任务 | 5-30分钟，2-5文件，中风险 | P2 |
| 复杂任务 | >30分钟，5+文件，高风险 | P1 |
| 紧急任务 | 立即响应，无延迟要求 | P0 |

### 3.2 自动化阈值

```yaml
自动进入下一阶段条件:
  C→A: 任务类型确认，复杂度评分≥3
  A→P: 分析完成，Skill选择确定
  P→D: 计划批准，资源就绪
  D→C2: 任务执行完成或达到检查点
  C2→A: 验证结果产出，存在改进空间
```

### 3.3 干预阈值

需要人工干预的情况：
- 优先级P0任务
- 复杂度评分≥8
- 风险等级"高"
- 验证结果"失败"
- 连续3次同一类型错误

---

## 4. 自动化规则

### 4.1 任务自动分类

```
输入: 任务描述
处理:
  1. 提取关键词
  2. 匹配任务类型
  3. 计算复杂度
  4. 分配优先级

输出: 任务分类结果
```

### 4.2 Skill自动匹配

| 任务类型 | 推荐Skill | 置信度 |
|---------|----------|--------|
| 深度分析 | planning-with-files | ≥90% |
| Bug修复 | systematic-debugging | ≥90% |
| 任务规划 | writing-plans | ≥90% |
| 创建功能 | skill-creator | ≥90% |
| 代码审查 | receiving-code-review | ≥90% |
| 完成验证 | verification-before-completion | ≥90% |
| 简单任务 | 直接执行 | N/A |

### 4.3 循环执行规则

```python
def capdca_cycle(task):
    # Phase 1: Check
    check_result = check_phase(task)
    if not check_result.should_proceed:
        return check_result
    
    # Phase 2: Analyze
    analyze_result = analyze_phase(check_result)
    
    # Phase 3: Plan
    plan_result = plan_phase(analyze_result)
    
    # Phase 4: Do
    do_result = execute_phase(plan_result)
    
    # Phase 5: Check (Verify)
    verify_result = verify_phase(do_result)
    
    # Phase 6: Adjust
    adjust_result = adjust_phase(verify_result)
    
    return adjust_result
```

### 4.4 自我优化规则

1. **每次循环结束后**：
   - 记录循环时间
   - 评估效率
   - 识别瓶颈
   - 生成优化建议

2. **每10次循环**：
   - 全面回顾
   - 更新规则
   - 优化阈值
   - 补充知识库

3. **每100次循环**：
   - 系统性重构
   - 架构升级
   - 新方法引入

---

## 5. 与AGENTS.md集成点

### 5.1 Skills使用检查

在每个任务开始前：
```
【CAPDCA Check】
1. 任务类型识别：______
2. 推荐Skill：______
3. 是否使用推荐Skill？（是/否）
4. 复杂度评分：______
5. 优先级：______
```

### 5.1.1 信息验证检查（2026-02-04新增）

**适用场景**: 半导体芯片Roadmap、投资决策数据、技术规格等关键信息

```
【信息验证Check】
1. 信息类型：______
   [ ] 芯片Roadmap [ ] 财务数据 [ ] 技术规格 [ ] 其他
   
2. 信息来源：______
   [ ] 官方发布 [ ] 权威媒体 [ ] 行业分析 [ ] 预测/估算
   
3. 来源验证：______
   [ ] 有官方链接 [ ] 无链接需标注
   
4. 置信度标记：______
   [ ] ✅ 高 (官方确认)
   [ ] ⚠️ 中 (行业分析)
   [ ] ❓ 低 (媒体预测)
   [ ] 🔲 未知
   
5. 交叉验证：______
   [ ] 多源确认 [ ] 单源确认 [ ] 未验证
```

### 5.1.2 华为昇腾Roadmap验证清单（示例）

| 验证项 | 正确信息 | 检查结果 |
|-------|---------|---------|
| 910C下一代 | 950 (无920/930/940) | ✅ 已验证 |
| 950发布时间 | 2026 Q1-Q4 | ✅ 已验证 |
| 960发布时间 | 2027 Q4 | ✅ 已验证 |
| 信息来源 | 华为全联接大会 | ✅ 已记录 |

### 5.2 任务→Skill映射

| 任务 | 应该使用的Skill | 实际使用 | 差异 |
|-----|---------------|---------|-----|
| 深度分析 | planning-with-files | ？ | ？ |
| Bug修复 | systematic-debugging | ？ | ？ |
| 任务规划 | writing-plans | ？ | ？ |
| 创建功能 | skill-creator | ？ | ？ |
| 代码审查 | receiving-code-review | ？ | ？ |
| 完成验证 | verification-before-completion | ？ | ？ |

### 5.3 自我优化记录

每次任务完成后：
```markdown
## CAPDCA循环记录 [日期]

**任务**：______
**使用Skill**：______
**循环时间**：______
**结果**：成功/失败
**优化点**：______
**下次改进**：______
```

---

## 6. 性能指标

### 6.1 循环效率指标

| 指标 | 计算方式 | 目标值 |
|-----|---------|-------|
| 平均循环时间 | 总时间/循环次数 | <30分钟 |
| 自动完成率 | 自动完成数/总数 | >80% |
| 一次成功率 | 首次成功数/总数 | >70% |
| Skill匹配准确率 | 正确匹配数/总数 | >90% |

### 6.2 质量指标

| 指标 | 计算方式 | 目标值 |
|-----|---------|-------|
| 任务完成率 | 完成数/总数 | >95% |
| 返工率 | 返工数/总数 | <10% |
| 知识库增长 | 新条目数/周期 | >5条/周 |
| 错误重复率 | 重复错误数/总数 | <5% |

---

## 7. 持续改进

### 7.1 周度回顾

- 检查循环效率指标
- 分析失败案例
- 更新优化策略
- 补充知识库

### 7.2 月度评估

- 全面性能评估
- 架构优化评估
- 新方法引入评估
- 目标达成评估

### 7.3 季度升级

- 系统性重构
- 新功能集成
- 流程优化升级
- 阈值动态调整

---

## 8. 附录

### 8.1 快速参考表

```
CAPDCA循环:
C → A → P → D → C → A

任务类型 → Skill匹配:
深度分析 → planning-with-files
Bug修复 → systematic-debugging
任务规划 → writing-plans
创建功能 → skill-creator
代码审查 → receiving-code-review
完成验证 → verification-before-completion
```

### 8.2 文件路径

- 框架文件: capdca-system/CAPDCA框架.md
- 任务管理器: capdca-system/自主任务管理器.md
- 错误追踪: capdca-system/错误追踪日志.md
- 循环记录: memory/capdca-cycles.md
- 优化日志: memory/capdca-optimizations.md
