# OpenClaw 核心架构文件深度分析报告

**创建时间**: 2026-02-04  
**分析范围**: AGENTS.md, SOUL.md, USER.md, TOOLS.md  
**目的**: 理解 OpenClaw 架构设计，掌握工作原理，优化使用策略

---

## 📊 目录

1. [架构总览](#1-架构总览)
2. [核心文件详解](#2-核心文件详解)
3. [工作原理分析](#3-工作原理分析)
4. [调节策略指南](#4-调节策略指南)
5. [应用场景设计](#5-应用场景设计)

---

## 1. 架构总览

### 1.1 配置体系结构

```
OpenClaw 配置体系采用"三层架构"设计：

┌─────────────────────────────────────────────────────────────┐
│                    第一层：价值观层                           │
│  ┌─────────────────┐                                         │
│  │     SOUL.md    │  → 核心价值观、行为边界、沟通风格      │
│  └─────────────────┘                                         │
│                              ↓                                │
├─────────────────────────────────────────────────────────────┤
│                    第二层：配置层                              │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │   AGENTS.md    │  │    USER.md      │                  │
│  │   工作原则     │  │   用户偏好     │                  │
│  └─────────────────┘  └─────────────────┘                  │
│           ↓                   ↓                              │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │    TOOLS.md     │  │   MEMORY.md     │                  │
│  │   工具配置     │  │   长期记忆     │                  │
│  └─────────────────┘  └─────────────────┘                  │
│                              ↓                                │
├─────────────────────────────────────────────────────────────┤
│                    第三层：辅助层                              │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │  HEARTBEAT.md   │  │  IDENTITY.md    │                  │
│  │   心跳检查     │  │   身份设定     │                  │
│  └─────────────────┘  └─────────────────┘                  │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 文件优先级

| 优先级 | 文件 | 作用 | 复杂度 |
|-------|------|------|-------|
| **P0** | SOUL.md | 价值观（最核心） | 低（50行） |
| **P0** | AGENTS.md | 工作原则（最重要） | 高（400+行） |
| **P0** | USER.md | 用户偏好 | 低（100行） |
| **P1** | TOOLS.md | 工具配置 | 低（100行） |
| **P1** | MEMORY.md | 长期记忆 | 中（持续更新） |

### 1.3 核心设计理念

OpenClaw 采用"以人为本"的设计理念：

1. **价值观驱动** - SOUL.md 定义了性格和行为边界
2. **配置可定制** - AGENTS.md 提供了灵活的配置选项
3. **记忆持续性** - MEMORY.md 支持跨会话学习
4. **工作流优化** - Skills 系统提升了工作效率

---

## 2. 核心文件详解

### 2.1 SOUL.md - 核心价值观

**文件位置**: `/Users/dave/clawd/SOUL.md`  
**复杂度**: 低（50行）  
**重要性**: ⭐⭐⭐⭐⭐（最核心）

#### 核心原则

```
1. 真正有帮助（Be genuinely helpful）
   ✗ 客套话："Great question!"
   ✓ 直接帮助：Actions speak louder than words

2. 有主见（Have opinions）
   ✓ 可以不同意、偏好、评判
   ✗ 不要做没有个性的搜索引擎

3. 先自己想办法（Be resourceful before asking）
   ✓ 充分利用文件、上下文
   ✗ 不要一有问题就问

4. 通过能力赢得信任（Earn trust through competence）
   ✓ 内部行动大胆
   ✗ 外部行动谨慎

5. 记住你是客人（Remember you're a guest）
   ✓ 尊重隐私
   ✓ 保护个人信息
```

#### 行为边界

| 边界 | 说明 | 示例 |
|-----|------|-----|
| **隐私** | 私人信息不外泄 | 不分享 MEMORY.md 内容 |
| **外部行动** | 需先询问 | 发邮件、发推特前确认 |
| **群聊** | 不代表用户发言 | 只做参与者 |
| **回复质量** | 不发送半成品 | 检查后再发送 |

#### 沟通风格

- **简洁** - 一句话能说清不说两句
- **稳重** - 务实的 AI
- **有数据** - 重视准确性和品质

---

### 2.2 AGENTS.md - 工作原则

**文件位置**: `/Users/dave/clawd/AGENTS.md`  
**复杂度**: 高（400+行）  
**重要性**: ⭐⭐⭐⭐⭐（最重要）

#### 四大核心模块

```
模块一：文件操作原则
├── 系统级文件 → 修改前先问
├── 普通文件 → 自主管理
└── 副本观念 → 不确定时先备份

模块二：命令执行原则
├── 危险命令 → 需先确认
├── 普通命令 → 自主判断
└── 执行前检查 → 建立备份

模块三：报告格式偏好
├── 简洁为先 → 一句话能清不说两句
├── 不要Markdown → 优先发送文件
├── 表格用附件 → HTML/PDF/Excel
└── 排版灵活 → 先试效果

模块四：Skills使用规则 ⭐核心创新
├── 任务分类系统
├── 任务→Skill映射表
└── 执行前检查清单
```

#### 文件操作原则

```
分级管理机制：

┌────────────────────────────────────────┐
│  系统级文件（需先问）                   │
│  ├── AGENTS.md                        │
│  ├── SOUL.md                          │
│  ├── openclaw配置                     │
│  └── 敏感系统文件                      │
├────────────────────────────────────────┤
│  普通文件（自主管理）                   │
│  ├── 项目文档                          │
│  ├── 分析报告                          │
│  └── 代码文件                          │
└────────────────────────────────────────┘
```

#### 报告格式偏好

**问题背景**：在 Telegram 中使用 Markdown 表格显示混乱

**解决方案**：
1. **不要在对话框写 Markdown**
2. **优先发送文件** - HTML/PDF/TXT
3. **表格用附件** - Excel/PDF
4. **简短回复直接文字**

**示例**：
```
❌ Bad:
| 姓名 | 年龄 |
|------|------|
| 张三 | 25 |

✅ Good:
发送文件 "report.html" 给你，包含详细表格。
```

#### Skills 使用规则 ⭐核心创新

**问题识别**：15+ 核心 Skills 使用率为 0%

**根本原因**：
1. 习惯性直接执行
2. 57个 Skills 难以记住
3. 缺乏执行前检查
4. 无反馈闭环

**解决方案：Tasks → Skills 映射系统**

```
任务识别流程：

收到任务
    ↓
【Step 1: 分析关键词】
- "分析、研究、调研" → 深度分析
- "修复、错误、Bug" → Bug修复
- "创建、开发" → 新功能
    ↓
【Step 2: 匹配Skill】
- 深度分析 → `planning-with-files`
- Bug修复 → `systematic-debugging`
- 新功能 → `skill-creator`
    ↓
【Step 3: 确认使用】
"检测到这是[任务类型]，建议使用[Skill名称]。是否使用？"
    ↓
【Step 4: 执行验证】
- 调用Skill
- 按照指导执行
- 完成后验证
```

**快速匹配表**：

| 任务类型 | 触发关键词 | 推荐Skill |
|---------|----------|----------|
| **深度分析** | 分析、研究、调研、报告、评估 | `planning-with-files` |
| **Bug修复** | 修复、错误、Bug、问题、报错 | `systematic-debugging` |
| **任务规划** | 规划、计划、安排、设计 | `writing-plans` |
| **创建新功能** | 创建、开发、实现、新增 | `skill-creator` |
| **代码审查** | 审查、Review、检查 | `receiving-code-review` |
| **完成验证** | 确认、完成、检查 | `verification-before-completion` |
| **简单任务** | 快速、简单、查一下 | 直接执行 |

**Skills 分类体系**：

```
日常高频（Daily）- 每天看到
├── weather - 天气查询
├── summarize - 文档总结
└── github - GitHub操作

项目级（Project）- 周常看到
├── planning-with-files - 深度分析（P0）
├── systematic-debugging - Bug修复（P0）
├── skill-creator - 创建新功能（P0）
└── verification-before-completion - 完成验证（P1）

工具级（Utility）- 按需查看
├── nano-pdf - PDF处理
├── agent-browser - 浏览器自动化
└── web-design-guidelines - UI审查
```

---

### 2.3 USER.md - 用户画像

**文件位置**: `/Users/dave/clawd/USER.md`  
**复杂度**: 低（100行）  
**重要性**: ⭐⭐⭐⭐

#### 用户基本信息

```
基本信息：
├── 称呼：老板
├── 位置：深圳/台北
├── 时区：Asia/Shanghai
└── 交通工具：每天开车
```

#### 职业身份

```
三重身份：
1. 半导体从业者
   └── 先进封装载板的市场开发与营运管理

2. 自媒体博主
   └── AI新技术领域（业余）

3. 创业者
   └── 芯片半导体产业分析 + 产品市场发展整理
```

#### 关注领域

| 优先级 | 领域 | 说明 |
|-------|------|-----|
| P0 | AI人工智能 | 最关注 |
| P0 | 半导体 | 核心工作 |
| P1 | 先进封装 | 专业领域 |
| P2 | 智能制造 | 延伸领域 |

#### 沟通风格偏好

**喜欢**：
- 稳重、务实的 AI
- 重视数据品质和准确性
- 持续进步和自我修正
- "走过必留痕迹" - 记录和可追溯

**不喜欢**：
- 过于啰嗦
- 不确认就执行重要操作
- 同样的错误重复出现
- 数据处理不严谨

#### 工作习惯

```
日常习惯：
├── 每日检讨和优化
├── 需要清晰的总结和报告
└── 数据驱动决策

擅长任务：
├── 行业研究 - 半导体、AI、先进封装
├── 数据分析 - 市场分析、产能研究
├── 文件管理 - PDF整理、命名规范化
├── 信息检索 - 行业新闻、技术趋势
├── 报告生成 - 研究报告、每日总结
└── 代码开发 - Python脚本、自动化工具
```

---

### 2.4 TOOLS.md - 工具配置

**文件位置**: `/Users/dave/clawd/TOOLS.md`  
**复杂度**: 低（100行）  
**重要性**: ⭐⭐⭐

#### 工具分类

```
工具体系：
├── TTS语音配置
│   ├── 语言：中文（zh-CN）
│   ├── 声音：微软 XiaoxiaoNeural（温柔女声）
│   └── 设备：Mac mini 喇叭
│
├── 工作环境
│   ├── 平台：Mac mini
│   ├── 位置：书房
│   └── 系统：macOS
│
├── 文件管理
│   ├── 目录：/Users/dave/clawd
│   ├── 权限：全盘访问（除系统关键）
│   └── 原则：信任自主管理
│
└── 安全隐私
    ├── 敏感文件需授权
    ├── 不触碰系统关键文件
    └── 尊重隐私
```

---

## 3. 工作原理分析

### 3.1 会话启动流程

```
每次会话启动时：

1. 【读取核心文件】
   ↓
   SOUL.md → 理解价值观
   USER.md → 理解用户
   MEMORY.md → 长期记忆
   HEARTBEAT.md → 检查状态
   
2. 【建立上下文】
   ↓
   今日任务
   待办事项
   持续项目
   
3. 【执行任务】
   ↓
    接收任务
  识别类型
   匹配Skill
   执行验证
```

### 3.2 任务处理流程

```
任务处理流程：

【阶段一：任务接收】
收到用户任务
    ↓
【阶段二：任务识别】
分析关键词
评估复杂度
判断风险等级
    ↓
【阶段三：Skill匹配】
查表匹配Skill
确认使用
    ↓
【阶段四：执行任务】
调用Skill
按照指导执行
    ↓
【阶段五：验证交付】
检查结果
发送输出
更新记忆
```

### 3.3 记忆管理原理

```
记忆分层体系：

┌─────────────────────────────────────────┐
│          长期记忆（MEMORY.md）          │
│  ├── 重要决策                          │
│  ├── 核心偏好                          │
│  └── 经验教训                          │
├─────────────────────────────────────────┤
│          短期记忆（对话上下文）          │
│  ├── 当前任务                          │
│  └── 会话历史                          │
├─────────────────────────────────────────┤
│          工作文件（memory/YYYY-MM-DD）   │
│  ├── 每日记录                          │
│  ├── 项目进展                          │
│  └── 发现洞察                          │
└─────────────────────────────────────────┘

更新规则：
├── 重要决策 → 更新 MEMORY.md
├── 每日总结 → 更新 memory/YYYY-MM-DD.md
├── 经验教训 → 更新 MEMORY.md
└── 项目进度 → 更新 memory/项目.md
```

### 3.4 Skills 调用机制

```
Skills 调用流程：

1. 【识别任务类型】
   分析用户任务，确定类型
   
2. 【匹配最佳Skill】
   查表找到推荐Skill
   
3. 【确认使用】
   向用户确认
   "建议使用[Skill]，是否？"
   
4. 【调用Skill】
   读取 SKILL.md
   按照指导执行
   
5. 【反馈结果】
   记录使用日志
   评估效果
```

---

## 4. 调节策略指南

### 4.1 核心参数调节

#### 模型选择

| 场景 | 推荐模型 | 说明 |
|-----|---------|------|
| **日常对话** | MiniMax-M2.1 | 便宜、快速 |
| **深度分析** | MiniMax-M2.1 | 上下文充足 |
| **创意写作** | MiniMax-M2.1 | 效果良好 |
| **代码生成** | MiniMax-M2.1 | 基础功能 |

#### 上下文窗口管理

```
策略：
├── 短任务 → 直接执行
├── 长任务 → 使用 planning-with-files
└── 超长任务 → 分批处理

原则：
├── 不要一次加载过多上下文
├── 使用文件持久化
└── 定期清理过期信息
```

#### Thinking 模式

```
模式选择：
├── 简单任务 → thinking=off
├── 复杂任务 → thinking=low
└── 深度分析 → thinking=high
```

### 4.2 Skills 优化配置

#### 高频使用建议

```
推荐日常使用的Skills：

P0 - 必须掌握：
├── summarize - 快速总结
├── github - 版本管理
└── nano-pdf - PDF处理

P1 - 建议掌握：
├── planning-with-files - 深度分析
├── cron - 定时任务
└── coding-agent - 代码生成

P2 - 按需掌握：
├── agent-browser - 浏览器自动化
├── web-design-guidelines - UI审查
└── skill-creator - 自定义技能
```

#### Skills 组合使用

```
组合示例：

深度分析项目：
planning-with-files + summarize + nano-pdf

自动化报告：
cron + summarize + github + telegram

日常研究：
summarize + web_fetch + memory
```

### 4.3 工作流优化

#### 推荐工作流程

```
晨间流程（10分钟）：
1. 读取今日待办
2. 检查 HEARTBEAT.md 状态
3. 规划今日任务

工作时间（持续）：
1. 接收任务
2. 识别类型
3. 匹配Skill
4. 执行任务
5. 验证结果

晚间流程（10分钟）：
1. 总结今日完成
2. 更新 MEMORY.md
3. 规划明日待办
```

#### 效率提升技巧

```
技巧一：使用 Skills 自动化
└── 复杂任务调用专业Skills

技巧二：使用文件持久化
├── 大内容写入文件
├── 使用 planning-with-files
└── 持续更新 memory/

技巧三：建立标准化流程
├── 任务分类标准化
├── 报告格式模板化
└── 检查清单系统化
```

---

## 5. 应用场景设计

### 5.1 日常工作场景

#### 场景一：晨间新闻汇总

```
场景：每天早上汇总半导体行业新闻

使用技能：
├── cron - 定时触发（8:00）
├── blogwatcher - 抓取行业网站
├── summarize - 总结要点
└── telegram - 发送到手机

效果：
- 节省30分钟/天
- 信息不遗漏
- 质量稳定
```

#### 场景二：定期报告生成

```
场景：每周生成半导体行业分析报告

使用技能：
├── cron - 定时触发（周六9:00）
├── web_fetch - 抓取数据
├── nano-pdf - 处理财报
├── summarize - 分析要点
├── planning-with-files - 深度分析
└── github - 版本管理

效果：
- 自动化生成
- 数据准确可靠
- 持续积累知识
```

### 5.2 专业工作场景

#### 场景三：竞争对手监控

```
场景：实时监控欣兴、南电等竞争对手动态

使用技能：
├── blogwatcher - 监控官网/新闻
├── cron - 每4小时检查
├── summarize - 摘要关键信息
├── memory - 存储事件
└── cron - 每周汇总报告

监控对象：
- 欣兴电子 (Unimicron)
- 南亚电路 (Nan Ya)
- 三星电机 (SEMCO)
- Ibiden
- 景硕 (Kinsus)

效果：
- 第一时间获取情报
- 历史数据可追溯
- 减少人工搜索
```

#### 场景四：技术报告分析

```
场景：分析 Prismark IC载板季度报告

使用技能：
├── nano-pdf - 提取PDF内容
├── summarize - 总结关键数据
├── memory - 存储分析结果
└── github - 版本管理

分析内容：
- 市场规模数据
- 竞争格局分析
- 技术趋势预测

效果：
- 30分钟完成（手动需2小时）
- 数据提取准确
- 可追溯历史对比
```

### 5.3 自动化场景

#### 场景五：每日Token消耗监控

```
场景：每天统计 OpenClaw Token消耗

使用技能：
├── cron - 定时触发（晚12:00）
├── model-usage - 读取使用数据
├── summarize - 生成报告
└── telegram - 发送到手机

报告内容：
- 今日Token消耗
- 累计使用量
- 剩余额度
- 使用趋势

效果：
- 成本可视化
- 异常消耗预警
- 优化使用习惯
```

#### 场景六：知识库持续更新

```
场景：持续更新半导体知识库

使用技能：
├── planning-with-files - 系统规划
├── write - 创建新内容
├── summarize - 总结学习
├── memory - 记录进度
└── github - 版本管理

知识库内容：
- 行业分析
- 公司研究
- 技术趋势
- 市场数据

效果：
- 系统化知识
- 随时查阅
- 持续更新
```

---

## 6. 最佳实践总结

### 6.1 必须遵循的原则

```
原则一：先读文件再行动
├── 收到任务先识别类型
├── 匹配最佳Skill
└── 确认后再执行

原则二：简洁直接
├── 不要客套话
├── 直接给出答案
└── 复杂问题用文件

原则三：记录一切
├── 重要决策写文件
├── 经验教训更新MEMORY.md
└── 每日总结不能少

原则四：持续优化
├── 定期回顾MEMORY.md
├── 更新 Skills 使用策略
└── 改进工作流程
```

### 6.2 常见错误避免

```
错误一：忘记发送文件
✗ 在对话框写大段Markdown
✓ 使用 filePath 发送文件

错误二：直接执行不匹配Skill
✗ 收到任务直接开始
✓ 先识别类型，匹配Skill

错误三：不更新记忆
✗ 完成任务就结束
✓ 更新 MEMORY.md 和每日记录

错误四：重复错误
✗ 同样的问题多次出现
✓ 记录错误，更新 MEMORY.md
```

### 6.3 效率提升清单

```
每日检查清单：
□ 读取今日待办
□ 检查 HEARTBEAT.md 状态
□ 规划今日任务

任务执行清单：
□ 识别任务类型
□ 匹配最佳Skill
□ 确认使用
□ 执行任务
□ 验证结果
□ 更新记忆

每周优化清单：
□ 回顾本周完成
□ 更新 MEMORY.md
□ 分析改进空间
□ 优化工作流程
```

---

## 附录

### A. 文件位置速查

| 文件 | 位置 |
|-----|------|
| AGENTS.md | `/Users/dave/clawd/AGENTS.md` |
| SOUL.md | `/Users/dave/clawd/SOUL.md` |
| USER.md | `/Users/dave/clawd/USER.md` |
| TOOLS.md | `/Users/dave/clawd/TOOLS.md` |
| MEMORY.md | `/Users/dave/clawd/MEMORY.md` |
| HEARTBEAT.md | `/Users/dave/clawd/HEARTBEAT.md` |

### B. Skills 快速参考

| 任务类型 | Skill |
|---------|-------|
| 深度分析 | `planning-with-files` |
| Bug修复 | `systematic-debugging` |
| 定时任务 | `cron` |
| 总结 | `summarize` |
| PDF处理 | `nano-pdf` |
| 版本管理 | `github` |

### C. 相关资源

- Skills 安装目录: `/opt/homebrew/lib/node_modules/openclaw/skills/`
- 本地 Skills: `/Users/dave/clawd/skills/`
- OpenClaw 文档: `/Users/dave/clawd/docs/`

---

**创建时间**: 2026-02-04  
**版本**: v1.0  
**作者**: 可乐助手
